<%- include('partials/header', { activePage: 'products' }) %>
<h1 class="mb-4">Products</h1>
<form class="form-inline mb-4" method="get" action="/admin/products" id="product-filter-form">
  <input 
    type="text" 
    class="form-control mr-2" 
    name="search" 
    placeholder="Search by name..." 
    value="<%= filters.search || '' %>"
    onkeydown="if(event.key==='Enter'){this.form.submit();}"
    autocomplete="off"
  >
  <select 
    class="form-control mr-2" 
    name="category" 
    onchange="this.form.submit()"
  >
    <option value="">All Categories</option>
    <% categories.forEach(cat => { %>
      <option value="<%= cat.id %>" <%= filters.category == cat.id ? 'selected' : '' %>><%= cat.name %></option>
    <% }) %>
  </select>
  <select 
    class="form-control mr-2" 
    name="subcategory" 
    onchange="this.form.submit()"
  >
    <option value="">All Subcategories</option>
    <% subcategories.forEach(sub => { %>
      <option value="<%= sub.id %>" <%= filters.subcategory == sub.id ? 'selected' : '' %>><%= sub.name %></option>
    <% }) %>
  </select>
  <a href="/admin/products/add" class="btn btn-success ml-2">Add Product</a>
</form>
<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>Image</th>
      <th>Name</th>
      <th>Category</th>
      <th>Subcategory</th>
      <th>Price</th>
      <th>Rating</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% products.forEach(product => { %>
      <tr>
        <td>
          <% if (product.image) { %>
            <img src="/uploads/<%= product.image %>" alt="Product" style="width:60px;height:60px;object-fit:cover;">
          <% } %>
        </td>
        <td><%= product.name %></td>
        <td><%= product.category?.name || '-' %></td>
        <td><%= product.subcategory?.name || '-' %></td>
        <td>$<%= product.price %></td>
        <td><%= product.rating %></td>
        <td>
          <a href="/admin/products/edit/<%= product.id %>" class="btn btn-sm btn-info">Edit</a>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>
<%- include('partials/footer') %>
